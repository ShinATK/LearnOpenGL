#cg #opengl

### 渲染管线输入

绘制图形前需要输入顶点数据

- 顶点数据 Vertex data：以数组形式传递的 3 个 3D 坐标作为输入，表示一个三角形，一系列顶点的集合
- 顶点 Vertex：一个 3D 坐标数据的集合
- 顶点数据由**顶点属性**（Vertex Attribute）表示
- 这里暂时假定每个顶点由一个 3D 位置和一些颜色值组成

输入：一系列的顶点数据
过程：设置顶点属性
输出：顶点对象（3D 位置 + 颜色值）

### 顶点着色器

顶点着色器 Vertex Shader：着色器语言 GLSL（OpenGL Shading Language）编写

- 输入：一个 3D 顶点坐标
	- 在 GPU 显存中使用**顶点缓冲对象**（Vertex Buffer Object，VBO）存储顶点数据，并配置 OpenGL 如何解释这些内存
		- 可以一次性发送一大批数据到显卡上
		- CPU 发送到显卡相对较慢
		- **只要可能，每次都要尝试尽量一次性发送尽可能多的数据**
	- 指定如何发送给显卡
	- 顶点着色器可以立即访问显存中的顶点数据
- 过程：矩阵变换
- 输出：另一种 3D 坐标


### 图元装配

**图元**（Primitive）：指定这些数据所表示的渲染类型

Primitive Assembly

- 输入：顶点着色器输出的所有顶点作为输入
- 过程：对顶点进行装配
- 输出：指定的图元的形状

### 几何着色器

Geometry Shader

- 输入：图元形式的一系列顶点的集合
- 过程：产生新顶点构造出新的图元
- 输出：其他形状

### 光栅化阶段

Rasterization Stage

- 输入：其他形状的图元
- 过程：映射到屏幕上相应的像素
- 输出：生成片段 Fragment（裁切 Clipping 掉视图以外的像素，来提升效率）

**OpenGL 中的一个片段是 OpenGL 渲染一个像素所需的所有数据**

### 片段着色器

Fragment Shader

- 输入：光栅化生成的片段
- 过程：计算光照、阴影、光的颜色等（OpenGL 高级效果产生的阶段）
- 输出：一个像素的最终颜色

### Alpha 测试和混合（Blending）阶段

- 输入：所有像素对应的颜色值
- 过程：
	- 检测片段对应的深度（和模板（stencil））值，判断前后关系
	- 检测 alpha 值（透明度），并对物体进行混合（Blend）
- 输出：最终的图片


> 大多数场合，只需要配置**顶点**和**片段着色器**就可以了
> 几何着色器是可选，通常使用默认